

defaultTasks 'buildproject'

// Clean
// Combine JS
// Minify JS
// Copy other assets
// Start jetty
// Reload in real time

apply plugin: 'js'
apply plugin: 'jetty'

buildscript {
	repositories {
		mavenCentral()
	}

	dependencies {
		classpath 'com.eriwen:gradle-js-plugin:1.5.0'	
	}
}

javascript.source {   
	dev {
		js {		
			srcDir "src/js"         
			include "*.js"
			exclude "*.min.js"
		}
	}   
}

combineJs {
	source = javascript.source.dev.js.files
	dest = file("${buildDir}/js/app.js")
}

minifyJs {
	source = combineJs
	dest = file("${buildDir}/js/app.min.js")
	closure {
		warningLevel = 'QUIET'
	}
}

jettyRun {
	contextPath ''
	webAppSourceDirectory new File("${buildDir}")
}

task copyAssets(type: Copy) {		
	from 'src'
	into "${buildDir}"
	include '*.html'
	include '**/*.css'	
}

task rebuild(dependsOn: [combineJs, minifyJs, copyAssets]) << {
	println 'Building..'
}

task buildproject(dependsOn: [clean, rebuild]) << {
	println 'Initial build starting..'
}


task server(dependsOn: [build, jettyRun]) {
	println 'Launching Server..'
}